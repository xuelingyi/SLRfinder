##### below is to call R scripts in the unix environemnt 
##### this script can also be modified to run vcftools in R env #########
ind=BEL_MAL
cd ${ind}
### run within the dataset folder

## make the sif file easy to read by step2_cluster2.R
cp ${ind}.csv sif.csv

module load r-env-singularity
# modify parameters in the Rscript if needed
srun singularity_wrapper exec Rscript --no-save ../step1_cluster1.R

ls | grep cl > subfolders

module load vcftools
while read subfolder
do
cd subfolder
mkdir file012

for chr in {1..21}
do
vcftools --gzvcf ../a15m75/${ind}_v7LG${chr}_a15m75.vcf.gz --positions ./whitelist/position.LG${chr}.list --012 --out ./file012/${ind}_v7LG${chr}_a15m75_LD${LD}cl${cl}
done

# modify dataname in the Rscript if needed (now use the universal name sif.csv)
srun singularity_wrapper exec Rscript --no-save ../../step1_cluster2.R

cd ../
done < subfolders

rm subfolders
rm sif.csv
